<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å››è»¸ç„¡äººæ©Ÿé£›è¡ŒéŠæˆ²ï¼šé£›å‘ç›®çš„åœ°</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: #1a1a2e;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        #gameContainer {
            position: relative;
            width: 100%;
            max-width: 1200px;
        }
        canvas {
            display: block;
            background: #87CEEB;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #fff;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }
        #rotorPanel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 8px;
            color: #fff;
            font-size: 12px;
        }
        .rotorBar {
            width: 80px;
            height: 12px;
            background: #333;
            margin: 3px 0;
            border-radius: 6px;
            overflow: hidden;
        }
        .rotorFill {
            height: 100%;
            transition: width 0.1s;
        }
        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #fff;
            text-align: center;
            border-radius: 8px;
        }
        #overlay h1 {
            font-size: 36px;
            color: #FFD700;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        #overlay h2 {
            font-size: 28px;
            color: #4ECDC4;
            margin-bottom: 15px;
        }
        #overlay p {
            font-size: 16px;
            margin: 8px 0;
            max-width: 500px;
            line-height: 1.6;
        }
        .btn {
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
            border: none;
            padding: 15px 40px;
            font-size: 20px;
            color: #fff;
            border-radius: 30px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(78,205,196,0.5);
        }
        .controls {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        .key {
            display: inline-block;
            background: #444;
            padding: 5px 12px;
            border-radius: 5px;
            margin: 2px;
            border: 1px solid #666;
        }
        #pauseHint {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }
        .stat {
            background: rgba(0,0,0,0.5);
            padding: 5px 10px;
            margin: 3px 0;
            border-radius: 5px;
            display: inline-block;
        }
        #soundBtn {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.5);
            border: none;
            color: #fff;
            padding: 5px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <div id="ui">
            <div class="stat">ğŸ”ï¸ é«˜åº¦: <span id="altitude">0</span> m</div><br>
            <div class="stat">ğŸ’¨ é€Ÿåº¦: <span id="speed">0</span> m/s</div><br>
            <div class="stat">ğŸ”‹ é›»æ± : <span id="battery">100</span>%</div><br>
            <div class="stat">ğŸ“ å‚¾æ–œ: <span id="tilt">0</span>Â°</div><br>
            <div class="stat">ğŸ”„ åèˆª: <span id="yaw">0</span>Â°</div><br>
            <div class="stat">ğŸ¯ é—œå¡: <span id="level">1</span></div>
        </div>
        <div id="rotorPanel">
            <div>ğŸš èºæ—‹æ§³è½‰é€Ÿ</div>
            <div>å·¦å‰: <span id="r1">50</span>%</div>
            <div class="rotorBar"><div class="rotorFill" id="rf1" style="width:50%;background:#4ECDC4;"></div></div>
            <div>å³å‰: <span id="r2">50</span>%</div>
            <div class="rotorBar"><div class="rotorFill" id="rf2" style="width:50%;background:#4ECDC4;"></div></div>
            <div>å·¦å¾Œ: <span id="r3">50</span>%</div>
            <div class="rotorBar"><div class="rotorFill" id="rf3" style="width:50%;background:#FFD700;"></div></div>
            <div>å³å¾Œ: <span id="r4">50</span>%</div>
            <div class="rotorBar"><div class="rotorFill" id="rf4" style="width:50%;background:#FFD700;"></div></div>
        </div>
        <button id="soundBtn" onclick="toggleSound()">ğŸ”Š éŸ³æ•ˆ: é–‹</button>
        <div id="pauseHint">æŒ‰ P æš«åœ | WASD/æ–¹å‘éµ æ§åˆ¶</div>
        <div id="overlay">
            <h1>ğŸš å››è»¸ç„¡äººæ©Ÿé£›è¡ŒéŠæˆ²</h1>
            <h2>é£›å‘ç›®çš„åœ°ï¼</h2>
            <p>é€éæ“æ§å››å€‹èºæ—‹æ§³çš„è½‰é€Ÿï¼Œè®“ç„¡äººæ©Ÿå‚¾æ–œç§»å‹•ï¼</p>
            <div class="controls">
                <p><strong>ğŸ® æ“æ§èªªæ˜ï¼š</strong></p>
                <p><span class="key">W</span> æˆ– <span class="key">â†‘</span> å¢åŠ æ¨åŠ›ï¼ˆä¸Šå‡ï¼‰</p>
                <p><span class="key">S</span> æˆ– <span class="key">â†“</span> æ¸›å°‘æ¨åŠ›ï¼ˆä¸‹é™ï¼‰</p>
                <p><span class="key">A</span> å·¦å‚¾ç§»å‹• <span class="key">D</span> å³å‚¾ç§»å‹•</p>
                <p><span class="key">â†</span><span class="key">â†’</span> å·¦å³åèˆªæ—‹è½‰</p>
            </div>
            <p>ğŸ”¬ <strong>ç‰©ç†åŸç†ï¼š</strong>ç•¶å·¦å´èºæ—‹æ§³æ¸›é€Ÿã€å³å´åŠ é€Ÿæ™‚ï¼Œ<br>æ©Ÿèº«æœƒå‘å·¦å‚¾æ–œï¼Œç”¢ç”Ÿæ°´å¹³æ¨åŠ›ï¼</p>
            <button class="btn" onclick="startGame()">ğŸ® é–‹å§‹éŠæˆ²</button>
        </div>
    </div>

    <script>
        // === éŠæˆ²è¨­å®š ===
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const overlay = document.getElementById('overlay');
        
        let soundEnabled = true;
        let audioCtx = null;
        
        // ç•«é¢å°ºå¯¸
        function resizeCanvas() {
            canvas.width = Math.min(window.innerWidth - 20, 1200);
            canvas.height = Math.min(window.innerHeight - 20, 600);
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // === éŠæˆ²ç‹€æ…‹ ===
        let gameState = 'menu'; // menu, playing, paused, win, lose
        let currentLevel = 1;
        let score = 0;
        let startTime = 0;
        
        // === ç„¡äººæ©Ÿç‰©ç†ç‹€æ…‹ ===
        let drone = {
            x: 100,
            y: 300,
            vx: 0,
            vy: 0,
            angle: 0,        // å‚¾æ–œè§’ (roll)
            pitch: 0,        // ä¿¯ä»°è§’
            yawAngle: 0,     // åèˆªè§’
            yawRate: 0,      // åèˆªé€Ÿåº¦
            rotors: [50, 50, 50, 50], // å·¦å‰ã€å³å‰ã€å·¦å¾Œã€å³å¾Œ (0-100%)
            battery: 100,
            propAngle: 0     // èºæ—‹æ§³æ—‹è½‰è§’åº¦
        };
        
        // ç‰©ç†å¸¸æ•¸
        const GRAVITY = 0.15;
        const DRAG = 0.98;
        const THRUST_POWER = 0.008;
        const TILT_SPEED = 0.8;
        const MAX_TILT = 35;
        const BATTERY_DRAIN = 0.008;
        
        // é—œå¡è¨­å®šï¼ˆgoalY æ ¹æ“š canvas é«˜åº¦å‹•æ…‹è¨ˆç®—ï¼‰
        let levels = [
            { // é—œå¡1ï¼šåŸºæœ¬é£›è¡Œ
                goalX: 900,
                goalY: 400, // æœƒåœ¨ resetLevel ä¸­èª¿æ•´
                wind: 0,
                obstacles: [],
                hint: "ä¿æŒå¹³è¡¡ï¼Œæ…¢æ…¢é£›å‘ç´…æ——ï¼æŒ‰ä½ W ä¸Šå‡ï¼ŒS ä¸‹é™",
                learn: "ä½ å­¸æœƒäº†ï¼šå››å€‹èºæ—‹æ§³åŒé€Ÿå¯ä»¥æ‡¸åœï¼"
            },
            { // é—œå¡2ï¼šå´é¢¨
                goalX: 850,
                goalY: 300,
                wind: 0.04,
                obstacles: [],
                hint: "æœ‰å´é¢¨ï¼ç”¨åæ–¹å‘å‚¾æ–œä¾†è£œå„Ÿï¼",
                learn: "ä½ å­¸æœƒäº†ï¼šå‚¾æ–œå¯ä»¥æŠµæŠ—é¢¨åŠ›ï¼"
            },
            { // é—œå¡3ï¼šéšœç¤™
                goalX: 950,
                goalY: 200,
                wind: 0.02,
                obstacles: [
                    {x: 350, y: 150, w: 30, h: 300},
                    {x: 550, y: 0, w: 30, h: 350},
                    {x: 750, y: 100, w: 30, h: 350}
                ],
                hint: "å°å¿ƒéšœç¤™ç‰©ï¼ç²¾æº–æ§åˆ¶é«˜åº¦ï¼",
                learn: "ä½ å­¸æœƒäº†ï¼šç²¾æº–æ§åˆ¶æ¨åŠ›ä¾†èª¿æ•´é«˜åº¦ï¼"
            }
        ];
        let currentLevelData = levels[0];
        
        // æŒ‰éµç‹€æ…‹
        let keys = {};
        
        // === éŸ³æ•ˆ ===
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        function playBeep(freq, duration, type = 'square') {
            if (!soundEnabled || !audioCtx) return;
            try {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = type;
                osc.frequency.value = freq;
                gain.gain.value = 0.1;
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start();
                osc.stop(audioCtx.currentTime + duration);
            } catch(e) {}
        }
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundBtn').textContent = soundEnabled ? 'ğŸ”Š éŸ³æ•ˆ: é–‹' : 'ğŸ”‡ éŸ³æ•ˆ: é—œ';
        }
        
        // === éŠæˆ²æ§åˆ¶ ===
        function startGame() {
            initAudio();
            resetLevel();
            gameState = 'playing';
            overlay.style.display = 'none';
            startTime = Date.now();
            playBeep(523, 0.1);
            playBeep(659, 0.1);
        }
        
        function resetLevel() {
            currentLevelData = JSON.parse(JSON.stringify(levels[currentLevel - 1]));
            
            // æ ¹æ“šç•«å¸ƒå¤§å°å‹•æ…‹èª¿æ•´ç›®æ¨™ä½ç½®
            const groundY = canvas.height - 50;
            if (currentLevel === 1) {
                currentLevelData.goalX = Math.min(canvas.width - 100, 800);
                currentLevelData.goalY = groundY - 100; // é è¿‘åœ°é¢
            } else if (currentLevel === 2) {
                currentLevelData.goalX = Math.min(canvas.width - 100, 750);
                currentLevelData.goalY = canvas.height / 2; // ä¸­é–“é«˜åº¦
            } else if (currentLevel === 3) {
                currentLevelData.goalX = Math.min(canvas.width - 100, 900);
                currentLevelData.goalY = 150; // è¼ƒé«˜ä½ç½®
            }
            
            drone = {
                x: 100,
                y: groundY - 80, // å¾åœ°é¢é™„è¿‘é–‹å§‹
                vx: 0,
                vy: 0,
                angle: 0,
                pitch: 0,
                yawAngle: 0,
                yawRate: 0,
                rotors: [52, 52, 52, 52], // é è¨­æ‡¸åœè½‰é€Ÿ
                battery: 100,
                propAngle: 0
            };
        }
        
        function showOverlay(title, subtitle, message, buttonText, buttonAction, learnText = '') {
            overlay.innerHTML = `
                <h1>${title}</h1>
                <h2>${subtitle}</h2>
                <p>${message}</p>
                ${learnText ? `<p style="color:#4ECDC4;font-size:18px;margin:15px 0;">ğŸ’¡ ${learnText}</p>` : ''}
                <button class="btn" onclick="${buttonAction}">${buttonText}</button>
            `;
            overlay.style.display = 'flex';
        }
        
        function nextLevel() {
            currentLevel++;
            if (currentLevel > 3) {
                currentLevel = 1;
                showOverlay('ğŸ‰ æ­å–œé€šé—œï¼', `ç¸½åˆ†ï¼š${score}`, 
                    'ä½ å·²ç¶“æŒæ¡äº†ç„¡äººæ©Ÿçš„åŸºæœ¬é£›è¡ŒåŸç†ï¼', 
                    'ğŸ”„ é‡æ–°é–‹å§‹', 'startGame()',
                    'å°è§’èºæ—‹æ§³åŒå‘æ—‹è½‰æ‰èƒ½ç©©å®šï¼');
            } else {
                resetLevel();
                gameState = 'playing';
                overlay.style.display = 'none';
                startTime = Date.now();
            }
        }
        
        function restartLevel() {
            resetLevel();
            gameState = 'playing';
            overlay.style.display = 'none';
            startTime = Date.now();
        }
        
        // === ç‰©ç†æ›´æ–° ===
        function updatePhysics() {
            if (gameState !== 'playing') return;
            
            // åŸºç¤æ¨åŠ› (é è¨­å‰›å¥½æ‡¸åœ)
            let baseThrust = 52;
            let tiltInput = 0;
            let yawInput = 0;
            
            // è™•ç†è¼¸å…¥ - W/S æ§åˆ¶å‡é™
            if (keys['KeyW']) baseThrust += 30;  // ä¸Šå‡
            if (keys['KeyS']) baseThrust -= 35;  // ä¸‹é™ï¼ˆæ¸›å°‘æ¨åŠ›è®“é‡åŠ›æ‹‰ä¸‹ï¼‰
            
            // A/D æ§åˆ¶å·¦å³å‚¾æ–œ
            if (keys['KeyA']) tiltInput = -1;
            if (keys['KeyD']) tiltInput = 1;
            
            // æ–¹å‘éµï¼šä¸Šä¸‹ä¹Ÿå¯å‡é™ï¼Œå·¦å³æ§åˆ¶åèˆª
            if (keys['ArrowUp']) baseThrust += 30;
            if (keys['ArrowDown']) baseThrust -= 35;
            if (keys['ArrowLeft']) yawInput = -1;
            if (keys['ArrowRight']) yawInput = 1;
            
            // è¨ˆç®—å››æ§³è½‰é€Ÿï¼ˆæ ¸å¿ƒç‰©ç†æ¨¡æ“¬ï¼‰
            // å·¦å‰ã€å³å‰ã€å·¦å¾Œã€å³å¾Œ
            let r1 = baseThrust; // å·¦å‰
            let r2 = baseThrust; // å³å‰
            let r3 = baseThrust; // å·¦å¾Œ
            let r4 = baseThrust; // å³å¾Œ
            
            // å‚¾æ–œæ§åˆ¶ï¼šå·¦å‚¾ = å·¦æ§³æ¸›é€Ÿï¼Œå³æ§³åŠ é€Ÿ
            r1 += tiltInput * 15;
            r3 += tiltInput * 15;
            r2 -= tiltInput * 15;
            r4 -= tiltInput * 15;
            
            // åèˆªæ§åˆ¶ï¼šå°è§’æ§³å·®ç•°
            r1 += yawInput * 10;
            r4 += yawInput * 10;
            r2 -= yawInput * 10;
            r3 -= yawInput * 10;
            
            // é™åˆ¶è½‰é€Ÿç¯„åœ
            drone.rotors[0] = Math.max(0, Math.min(100, r1));
            drone.rotors[1] = Math.max(0, Math.min(100, r2));
            drone.rotors[2] = Math.max(0, Math.min(100, r3));
            drone.rotors[3] = Math.max(0, Math.min(100, r4));
            
            // æ ¹æ“šæ§³é€Ÿå·®è¨ˆç®—å‚¾æ–œè§’
            let leftAvg = (drone.rotors[0] + drone.rotors[2]) / 2;
            let rightAvg = (drone.rotors[1] + drone.rotors[3]) / 2;
            let targetAngle = (rightAvg - leftAvg) * 0.5;
            drone.angle += (targetAngle - drone.angle) * 0.1;
            drone.angle = Math.max(-MAX_TILT, Math.min(MAX_TILT, drone.angle));
            
            // åèˆªè¨ˆç®—
            let frontAvg = (drone.rotors[0] + drone.rotors[1]) / 2;
            let backAvg = (drone.rotors[2] + drone.rotors[3]) / 2;
            drone.yawRate = ((drone.rotors[0] + drone.rotors[3]) - (drone.rotors[1] + drone.rotors[2])) * 0.02;
            drone.yawAngle += drone.yawRate;
            
            // è¨ˆç®—ç¸½æ¨åŠ›
            let totalThrust = drone.rotors.reduce((a, b) => a + b, 0) / 4;
            let thrustForce = totalThrust * THRUST_POWER;
            
            // æ¨åŠ›åˆ†è§£ï¼ˆæ ¹æ“šå‚¾æ–œè§’ï¼‰
            let angleRad = drone.angle * Math.PI / 180;
            let thrustX = Math.sin(angleRad) * thrustForce;
            let thrustY = -Math.cos(angleRad) * thrustForce;
            
            // æ‡‰ç”¨ç‰©ç†
            drone.vx += thrustX;
            drone.vy += thrustY + GRAVITY;
            
            // é¢¨åŠ›å½±éŸ¿
            drone.vx += currentLevelData.wind;
            
            // é˜»åŠ›
            drone.vx *= DRAG;
            drone.vy *= DRAG;
            
            // æ›´æ–°ä½ç½®
            drone.x += drone.vx;
            drone.y += drone.vy;
            
            // é›»æ± æ¶ˆè€—
            let avgRotor = drone.rotors.reduce((a, b) => a + b, 0) / 4;
            drone.battery -= BATTERY_DRAIN * (avgRotor / 50);
            
            // èºæ—‹æ§³æ—‹è½‰
            drone.propAngle += avgRotor * 0.3;
            
            // ç¢°æ’æª¢æ¸¬
            checkCollisions();
            
            // æ›´æ–°UI
            updateUI();
        }
        
        function checkCollisions() {
            const groundY = canvas.height - 50;
            
            // åœ°é¢ç¢°æ’
            if (drone.y > groundY - 20) {
                if (Math.abs(drone.vy) > 3 || Math.abs(drone.angle) > 20) {
                    gameOver("å¢œæ©Ÿäº†ï¼é™è½å¤ªå¿«æˆ–è§’åº¦å¤ªå¤§ï¼");
                    return;
                }
                drone.y = groundY - 20;
                drone.vy = 0;
            }
            
            // å¤©èŠ±æ¿
            if (drone.y < 30) {
                drone.y = 30;
                drone.vy = 0;
            }
            
            // ç‰†å£
            if (drone.x < 30 || drone.x > canvas.width - 30) {
                gameOver("æ’ç‰†äº†ï¼");
                return;
            }
            
            // éšœç¤™ç‰©ç¢°æ’
            for (let obs of currentLevelData.obstacles) {
                if (drone.x > obs.x - 25 && drone.x < obs.x + obs.w + 25 &&
                    drone.y > obs.y - 15 && drone.y < obs.y + obs.h + 15) {
                    gameOver("æ’åˆ°éšœç¤™ç‰©ï¼");
                    return;
                }
            }
            
            // é›»æ± è€—ç›¡
            if (drone.battery <= 0) {
                gameOver("é›»æ± è€—ç›¡ï¼");
                return;
            }
            
            // åˆ°é”ç›®æ¨™
            let dx = drone.x - currentLevelData.goalX;
            let dy = drone.y - currentLevelData.goalY;
            if (Math.sqrt(dx*dx + dy*dy) < 40) {
                levelComplete();
            }
        }
        
        function gameOver(reason) {
            gameState = 'lose';
            playBeep(200, 0.3);
            showOverlay('ğŸ’¥ å¤±æ•—ï¼', reason, 
                `æç¤ºï¼š${currentLevelData.hint}`, 
                'ğŸ”„ é‡è©¦', 'restartLevel()');
        }
        
        function levelComplete() {
            gameState = 'win';
            let timeBonus = Math.max(0, 1000 - (Date.now() - startTime) / 100);
            let batteryBonus = drone.battery * 10;
            let levelScore = Math.floor(timeBonus + batteryBonus);
            score += levelScore;
            
            playBeep(523, 0.1);
            setTimeout(() => playBeep(659, 0.1), 100);
            setTimeout(() => playBeep(784, 0.2), 200);
            
            showOverlay('ğŸ‰ éé—œï¼', `ç¬¬ ${currentLevel} é—œå®Œæˆï¼`, 
                `æœ¬é—œå¾—åˆ†ï¼š${levelScore} | ç¸½åˆ†ï¼š${score}`, 
                'â¡ï¸ ä¸‹ä¸€é—œ', 'nextLevel()',
                currentLevelData.learn);
        }
        
        function updateUI() {
            document.getElementById('altitude').textContent = Math.floor(canvas.height - drone.y - 50);
            document.getElementById('speed').textContent = Math.floor(Math.sqrt(drone.vx*drone.vx + drone.vy*drone.vy) * 10);
            document.getElementById('battery').textContent = Math.floor(drone.battery);
            document.getElementById('tilt').textContent = drone.angle.toFixed(1);
            document.getElementById('yaw').textContent = drone.yawAngle.toFixed(1);
            document.getElementById('level').textContent = currentLevel;
            
            // æ›´æ–°èºæ—‹æ§³é¡¯ç¤º
            for (let i = 0; i < 4; i++) {
                document.getElementById('r' + (i+1)).textContent = Math.floor(drone.rotors[i]);
                let fill = document.getElementById('rf' + (i+1));
                fill.style.width = drone.rotors[i] + '%';
                // é¡è‰²æ ¹æ“šè½‰é€Ÿè®ŠåŒ–
                if (drone.rotors[i] > 70) fill.style.background = '#FF6B6B';
                else if (drone.rotors[i] > 40) fill.style.background = '#4ECDC4';
                else fill.style.background = '#95E1D3';
            }
        }
        
        // === ç¹ªè£½ ===
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // å¤©ç©ºæ¼¸å±¤
            let skyGrad = ctx.createLinearGradient(0, 0, 0, canvas.height);
            skyGrad.addColorStop(0, '#87CEEB');
            skyGrad.addColorStop(1, '#E0F6FF');
            ctx.fillStyle = skyGrad;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // é›²æœµ
            drawClouds();
            
            // åœ°é¢
            ctx.fillStyle = '#7CB342';
            ctx.fillRect(0, canvas.height - 50, canvas.width, 50);
            ctx.fillStyle = '#8BC34A';
            ctx.fillRect(0, canvas.height - 50, canvas.width, 10);
            
            // éšœç¤™ç‰©
            ctx.fillStyle = '#795548';
            for (let obs of currentLevelData.obstacles) {
                ctx.fillRect(obs.x, obs.y, obs.w, obs.h);
                // é ‚éƒ¨è£é£¾
                ctx.fillStyle = '#5D4037';
                ctx.fillRect(obs.x - 5, obs.y, obs.w + 10, 10);
                ctx.fillStyle = '#795548';
            }
            
            // é¢¨å‘æŒ‡ç¤ºå™¨
            if (currentLevelData.wind !== 0) {
                ctx.save();
                ctx.fillStyle = 'rgba(255,255,255,0.8)';
                ctx.font = '16px Arial';
                let windDir = currentLevelData.wind > 0 ? 'â†’' : 'â†';
                let windStr = Math.abs(currentLevelData.wind * 100).toFixed(0);
                ctx.fillText(`ğŸ’¨ é¢¨åŠ›: ${windDir} ${windStr}`, canvas.width / 2 - 50, 30);
                ctx.restore();
            }
            
            // ç›®æ¨™æ——å­
            drawFlag(currentLevelData.goalX, currentLevelData.goalY);
            
            // ç„¡äººæ©Ÿ
            drawDrone();
            
            // æš«åœç•«é¢
            if (gameState === 'paused') {
                ctx.fillStyle = 'rgba(0,0,0,0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 36px Microsoft JhengHei';
                ctx.textAlign = 'center';
                ctx.fillText('â¸ï¸ æš«åœ', canvas.width/2, canvas.height/2 - 40);
                ctx.font = '18px Microsoft JhengHei';
                ctx.fillText('ğŸ’¡ æç¤ºï¼š' + currentLevelData.hint, canvas.width/2, canvas.height/2 + 10);
                ctx.fillText('å¾Œæ§³åŠ é€Ÿ = å‘å‰é£› | å°è§’æ§³åŒå‘ = ç©©å®šæ—‹è½‰', canvas.width/2, canvas.height/2 + 40);
                ctx.fillText('æŒ‰ P ç¹¼çºŒ', canvas.width/2, canvas.height/2 + 80);
                ctx.textAlign = 'left';
            }
        }
        
        function drawClouds() {
            ctx.fillStyle = 'rgba(255,255,255,0.8)';
            // ç°¡å–®é›²æœµ
            [[100, 60], [300, 100], [500, 50], [700, 80], [900, 70]].forEach(([x, y]) => {
                ctx.beginPath();
                ctx.arc(x, y, 25, 0, Math.PI * 2);
                ctx.arc(x + 25, y - 10, 20, 0, Math.PI * 2);
                ctx.arc(x + 50, y, 25, 0, Math.PI * 2);
                ctx.arc(x + 25, y + 10, 18, 0, Math.PI * 2);
                ctx.fill();
            });
        }
        
        function drawFlag(x, y) {
            // é–ƒçˆæ•ˆæœ
            const pulse = Math.sin(Date.now() / 200) * 0.3 + 0.7;
            
            // ç›®æ¨™åœˆï¼ˆå¤§åœˆï¼Œæ›´æ˜é¡¯ï¼‰
            ctx.strokeStyle = `rgba(255, 215, 0, ${pulse})`;
            ctx.lineWidth = 4;
            ctx.setLineDash([10, 5]);
            ctx.beginPath();
            ctx.arc(x, y + 20, 55, 0, Math.PI * 2);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // å…§åœˆ
            ctx.strokeStyle = `rgba(76, 175, 80, ${pulse})`;
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(x, y + 20, 35, 0, Math.PI * 2);
            ctx.stroke();
            
            // æ——æ¡¿ï¼ˆæ›´é•·ï¼‰
            ctx.strokeStyle = '#5D4037';
            ctx.lineWidth = 6;
            ctx.beginPath();
            ctx.moveTo(x, y - 10);
            ctx.lineTo(x, y + 100);
            ctx.stroke();
            
            // æ——æ¡¿é ‚çƒ
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(x, y - 15, 8, 0, Math.PI * 2);
            ctx.fill();
            
            // ç´…æ——ï¼ˆæ›´å¤§ï¼Œå¸¶æ³¢æµªæ•ˆæœï¼‰
            const wave = Math.sin(Date.now() / 300) * 3;
            ctx.fillStyle = '#E53935';
            ctx.beginPath();
            ctx.moveTo(x, y - 10);
            ctx.quadraticCurveTo(x + 35 + wave, y + 5, x + 55, y + 15 + wave);
            ctx.quadraticCurveTo(x + 35, y + 25, x, y + 40);
            ctx.closePath();
            ctx.fill();
            
            // æ——å­é‚Šæ¡†
            ctx.strokeStyle = '#B71C1C';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // ã€Œç›®æ¨™ã€æ–‡å­—
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 14px Microsoft JhengHei';
            ctx.textAlign = 'center';
            ctx.fillText('ğŸ¯ ç›®æ¨™', x, y + 75);
            ctx.textAlign = 'left';
        }
        
        function drawDrone() {
            ctx.save();
            ctx.translate(drone.x, drone.y);
            ctx.rotate(drone.angle * Math.PI / 180);
            
            // æ©Ÿèº«
            ctx.fillStyle = '#333';
            ctx.fillRect(-30, -5, 60, 10);
            ctx.fillRect(-5, -25, 10, 50);
            
            // ä¸­å¿ƒ
            ctx.fillStyle = '#4CAF50';
            ctx.beginPath();
            ctx.arc(0, 0, 8, 0, Math.PI * 2);
            ctx.fill();
            
            // å››å€‹èºæ—‹æ§³è‡‚
            const rotorPos = [[-25, -20], [25, -20], [-25, 20], [25, 20]];
            
            rotorPos.forEach((pos, i) => {
                // é¦¬é”
                ctx.fillStyle = '#666';
                ctx.beginPath();
                ctx.arc(pos[0], pos[1], 6, 0, Math.PI * 2);
                ctx.fill();
                
                // èºæ—‹æ§³ï¼ˆæ—‹è½‰ï¼‰
                ctx.save();
                ctx.translate(pos[0], pos[1]);
                let rotorSpeed = drone.rotors[i] / 50;
                ctx.rotate(drone.propAngle * rotorSpeed * (i % 2 === 0 ? 1 : -1) * Math.PI / 180);
                
                // æ§³è‘‰é¡è‰²æ ¹æ“šè½‰é€Ÿ
                let hue = 120 - drone.rotors[i];
                ctx.strokeStyle = `hsl(${hue}, 80%, 50%)`;
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(-12, 0);
                ctx.lineTo(12, 0);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(0, -12);
                ctx.lineTo(0, 12);
                ctx.stroke();
                
                ctx.restore();
            });
            
            // æ–¹å‘æŒ‡ç¤ºï¼ˆå‰æ–¹ï¼‰
            ctx.fillStyle = '#FF5722';
            ctx.beginPath();
            ctx.moveTo(0, -30);
            ctx.lineTo(-5, -22);
            ctx.lineTo(5, -22);
            ctx.closePath();
            ctx.fill();
            
            ctx.restore();
            
            // æ¨åŠ›å‘é‡è¦–è¦ºåŒ–
            if (gameState === 'playing') {
                let avgThrust = drone.rotors.reduce((a, b) => a + b, 0) / 4;
                let thrustLen = avgThrust * 0.3;
                ctx.strokeStyle = 'rgba(255, 152, 0, 0.7)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(drone.x, drone.y + 15);
                ctx.lineTo(drone.x, drone.y + 15 + thrustLen);
                ctx.stroke();
            }
        }
        
        // === éŠæˆ²å¾ªç’° ===
        function gameLoop() {
            updatePhysics();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        // === äº‹ä»¶è™•ç† ===
        document.addEventListener('keydown', (e) => {
            keys[e.code] = true;
            
            if (e.code === 'KeyP' && gameState === 'playing') {
                gameState = 'paused';
            } else if (e.code === 'KeyP' && gameState === 'paused') {
                gameState = 'playing';
            }
            
            // é˜²æ­¢æ–¹å‘éµæ»¾å‹•é é¢
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'Space'].includes(e.code)) {
                e.preventDefault();
            }
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });
        
        // é–‹å§‹éŠæˆ²å¾ªç’°
        gameLoop();
    </script>
</body>
</html>
